<!DOCTYPE struts PUBLIC
        "-//Apache Software Foundation//DTD Struts Configuration 2.5//EN"
        "http://struts.apache.org/dtds/struts-2.5.dtd">
<struts>

    <constant name="struts.multipart.parser" value="spring"/>

    <bean type="org.apache.struts2.dispatcher.multipart.MultiPartRequest"
          name="spring"
          class="org.apache.roller.weblogger.ui.struts2.util.SpringMultipartParser"
          scope="default"/>

    <!-- Weblogger default package -->
    <package name="weblogger" namespace="/tb-ui" extends="struts-default">

        <!-- Define Tiles result type -->
        <result-types>
            <result-type name="tiles" class="org.apache.struts2.views.tiles.TilesResult" />
        </result-types>

        <!-- define our own interceptors and a custom interceptor stack -->
        <interceptors>
            <interceptor name="UIActionInterceptor"
                         class="org.apache.roller.weblogger.ui.struts2.util.UIActionInterceptor" />
            <interceptor name="UISecurityInterceptor"
                         class="org.apache.roller.weblogger.ui.struts2.util.UISecurityInterceptor" />
            <interceptor name="UIActionPrepareInterceptor"
                         class="org.apache.roller.weblogger.ui.struts2.util.UIActionPrepareInterceptor" />

            <!-- Define a custom interceptor stack for Roller so that we can
                 add in our own custom interceptors.  We basically copy the
                 default stack from struts2 rather than extend it because we
                 need to have our custom interceptors go in the middle of the
                 default stack -->
            <interceptor-stack name="rollerStack">
                <interceptor-ref name="exception"/>
                <!-- <interceptor-ref name="alias"/> -->
                <interceptor-ref name="servletConfig"/>
                <!-- <interceptor-ref name="prepare"/> -->
                <interceptor-ref name="i18n"/>
                <interceptor-ref name="chain"/>
                <!-- <interceptor-ref name="debugging"/> -->
                <!-- <interceptor-ref name="profiling"/> -->
                <!-- <interceptor-ref name="scopedModelDriven"/> -->
                <!-- <interceptor-ref name="modelDriven"/> -->
                <interceptor-ref name="fileUpload"/>
                <interceptor-ref name="checkbox"/>
                <interceptor-ref name="multiselect"/>
                <interceptor-ref name="staticParams"/>
                <interceptor-ref name="actionMappingParams"/>
                <interceptor-ref name="params">
                    <param name="excludeParams">^action:.*,^method:.*</param>
                </interceptor-ref>
                <interceptor-ref name="conversionError"/>

                <!-- custom Roller interceptors -->
                <interceptor-ref name="UIActionInterceptor">
                    <param name="excludeMethods">cancel</param>
                </interceptor-ref>
                <interceptor-ref name="UISecurityInterceptor">
                    <param name="excludeMethods">cancel</param>
                </interceptor-ref>
                <!-- prepare interceptor placed later in the stack so weblog and userid can
                     be populated by the UIActionInterceptor. -->
                <interceptor-ref name="prepare">
                    <param name="excludeMethods">cancel</param>
                </interceptor-ref>

                <!-- validation interceptors, MUST come after our custom interceptors -->
                <interceptor-ref name="validation">
                    <param name="excludeMethods">input,back,cancel,browse</param>
                </interceptor-ref>
                <interceptor-ref name="workflow">
                    <param name="excludeMethods">input,back,cancel,browse</param>
                </interceptor-ref>

            </interceptor-stack>
        </interceptors>

        <!-- use our own interceptor stack which extends the default stack -->
        <default-interceptor-ref name="rollerStack"/>


        <!-- results made available to all actions -->
        <global-results>
            <result name="access-denied" type="tiles">.denied</result>
        </global-results>

        <!-- Simple actions which basically just replace the global-forwards from
             the old struts 1 config.  this is the only way to do it in struts 2 -->
        <action name="home">
            <result type="redirect">/</result>
        </action>

        <action name="login-redirect">
            <result>/WEB-INF/jsps/core/login-redirect.jsp</result>
        </action>

        <action name="logout">
            <result>/WEB-INF/jsps/core/logout-redirect.jsp</result>
        </action>

        <action name="login" class="org.apache.roller.weblogger.ui.struts2.core.Login">
            <result type="tiles">.Login</result>
        </action>

        <action name="register" class="org.apache.roller.weblogger.ui.struts2.util.UIAction">
            <param name="pageTitleReal">newUser.addNewUser</param>
            <param name="requiredGlobalRole">NOAUTHNEEDED</param>
            <param name="requiredWeblogRole">NOBLOGNEEDED</param>
            <result name="success" type="tiles">.Profile</result>
        </action>

        <action name="emailResponse!*" method="{1}"
                class="org.apache.roller.weblogger.ui.struts2.core.Login">
            <result name="successActivate" type="tiles">.Welcome</result>
            <allowed-methods>activate</allowed-methods>
        </action>

        <action name="profile" class="org.apache.roller.weblogger.ui.struts2.util.UIAction">
            <param name="pageTitleReal">yourProfile.title</param>
            <param name="requiredGlobalRole">BLOGGER</param>
            <param name="requiredWeblogRole">NOBLOGNEEDED</param>
            <result name="success" type="tiles">.Profile</result>
        </action>

        <action name="createWeblog" class="org.apache.roller.weblogger.ui.struts2.util.UIAction">
            <param name="pageTitleReal">createWebsite.title</param>
            <param name="requiredGlobalRole">BLOGGER</param>
            <param name="requiredWeblogRole">NOBLOGNEEDED</param>
            <result name="success" type="tiles">.WeblogConfig</result>
        </action>

        <action name="menu" class="org.apache.roller.weblogger.ui.struts2.util.UIAction">
            <param name="pageTitleReal">yourWebsites.title</param>
            <param name="requiredGlobalRole">BLOGGER</param>
            <param name="requiredWeblogRole">NOBLOGNEEDED</param>
            <result name="success" type="tiles">.MainMenu</result>
        </action>

    </package>


    <!-- Weblogger install/bootstrap actions -->
    <package name="weblogger-install" namespace="/tb-ui/install" extends="weblogger">

        <action name="install"
                class="org.apache.roller.weblogger.ui.struts2.core.Install">
            <param name="actionName">install</param>
            <result name="database_error" type="tiles">.DatabaseError</result>
            <result name="create_database" type="tiles">.CreateDatabase</result>
            <result name="upgrade_database" type="tiles">.UpgradeDatabase</result>
            <result name="bootstrap" type="tiles">.Bootstrap</result>
            <result name="success" type="chain">home</result>
        </action>

    </package>


    <!-- Weblogger Admin UI (includes planet) -->
    <package name="weblogger-admin" namespace="/tb-ui/admin" extends="weblogger">

        <action name="globalConfig!*" method="{1}"
                class="org.apache.roller.weblogger.ui.struts2.core.GlobalConfig">
            <result name="success" type="tiles">.GlobalConfig</result>
            <allowed-methods>save</allowed-methods>
        </action>

        <action name="userAdmin" class="org.apache.roller.weblogger.ui.struts2.util.UIAction">
            <param name="actionName">userAdmin</param>
            <param name="pageTitleReal">userAdmin.title.userAdministration</param>
            <param name="desiredMenu">admin</param>
            <param name="requiredWeblogRole">NOBLOGNEEDED</param>
            <result name="success" type="tiles">.UserAdmin</result>
        </action>

        <action name="pingTargets" class="org.apache.roller.weblogger.ui.struts2.util.UIAction">
            <param name="actionName">pingTargets</param>
            <param name="pageTitleReal">pingTargets.pingTargets</param>
            <param name="desiredMenu">admin</param>
            <param name="requiredWeblogRole">NOBLOGNEEDED</param>
            <result name="success" type="tiles">.PingTargets</result>
        </action>

        <action name="cacheInfo" class="org.apache.roller.weblogger.ui.struts2.util.UIAction">
            <param name="actionName">cacheInfo</param>
            <param name="pageTitleReal">cacheInfo.title</param>
            <param name="desiredMenu">admin</param>
            <param name="requiredWeblogRole">NOBLOGNEEDED</param>
            <result name="success" type="tiles">.CacheInfo</result>
        </action>

        <action name="planetEdit" class="org.apache.roller.weblogger.ui.struts2.util.UIAction">
            <param name="actionName">planetEdit</param>
            <param name="pageTitleReal">planetSubscriptions.title</param>
            <param name="desiredMenu">admin</param>
            <param name="requiredWeblogRole">NOBLOGNEEDED</param>
            <result name="success" type="tiles">.PlanetEdit</result>
        </action>

        <action name="planets" class="org.apache.roller.weblogger.ui.struts2.util.UIAction">
            <param name="actionName">planets</param>
            <param name="pageTitleReal">planets.pagetitle</param>
            <param name="desiredMenu">admin</param>
            <param name="requiredWeblogRole">NOBLOGNEEDED</param>
            <result name="success" type="tiles">.Planets</result>
        </action>
    </package>


    <!-- Weblogger Authoring UI -->
    <package name="weblogger-authoring" namespace="/tb-ui/authoring" extends="weblogger">

        <action name="mediaFileAdd!*" method="{1}"
                class="org.apache.roller.weblogger.ui.struts2.editor.MediaFileEdit">
            <param name="actionName">mediaFileAdd</param>
            <param name="pageTitle">mediaFileAdd.title</param>
            <result name="input" type="tiles">.MediaFileEdit</result>
            <result name="success" type="chain">mediaFileView</result>
            <result name="error" type="tiles">.MediaFileEdit</result>
            <allowed-methods>save</allowed-methods>
        </action>

        <action name="mediaFileEdit!*" method="{1}"
                class="org.apache.roller.weblogger.ui.struts2.editor.MediaFileEdit">
            <param name="actionName">mediaFileEdit</param>
            <param name="pageTitle">mediaFile.edit.title</param>
            <result name="input" type="tiles">.MediaFileEdit</result>
            <result name="success" type="chain">mediaFileView</result>
            <result name="error" type="tiles">.MediaFileEdit</result>
            <result name="cancel" type="redirectAction">
                <param name="actionName">mediaFileView</param>
                <param name="weblogId">${weblogId}</param>
                <param name="directoryName">${directoryName}</param>
            </result>
            <allowed-methods>cancel,save</allowed-methods>
        </action>

        <action name="mediaFileView!*" method="{1}"
                class="org.apache.roller.weblogger.ui.struts2.editor.MediaFileView">
            <result name="success" type="tiles">.MediaFileView</result>
            <allowed-methods>createNewDirectory,deleteFolder,deletedSelected,moveSelected,view</allowed-methods>
        </action>

        <action name="mediaFileChooser" class="org.apache.roller.weblogger.ui.struts2.util.UIAction">
            <param name="actionName">mediaFileChooser</param>
            <param name="pageTitleReal">mediaFileImageChooser.title</param>
            <param name="desiredMenu">editor</param>
            <param name="requiredGlobalRole">BLOGGER</param>
            <param name="requiredWeblogRole">EDIT_DRAFT</param>
            <result name="success" type="tiles">.MediaFileChooser</result>
        </action>

        <action name="entryAdd!*" method="{1}"
                class="org.apache.roller.weblogger.ui.struts2.editor.EntryEdit">
            <param name="actionName">entryAdd</param>
            <param name="pageTitle">weblogEdit.title.newEntry</param>
            <result name="input" type="tiles">.EntryEdit</result>
            <result name="success" type="redirectAction">
                <param name="actionName">entryEdit!firstSave</param>
                <param name="weblogId">${weblogId}</param>
                <param name="bean.id">${bean.id}</param>
            </result>
            <allowed-methods>publish,saveDraft</allowed-methods>
        </action>

        <action name="entryEdit!*" method="{1}"
                class="org.apache.roller.weblogger.ui.struts2.editor.EntryEdit">
            <param name="actionName">entryEdit</param>
            <param name="pageTitle">weblogEdit.title.editEntry</param>
            <result name="input" type="tiles">.EntryEdit</result>
            <result name="error" type="chain">menu</result>
            <result name="deleted" type="redirectAction">
                <param name="actionName">entryAdd</param>
                <param name="weblogId">${weblogId}</param>
            </result>
            <result name="list" type="chain">entries</result>
            <allowed-methods>firstSave,publish,remove,removeViaList,saveDraft</allowed-methods>
        </action>

        <action name="entries"
                class="org.apache.roller.weblogger.ui.struts2.editor.Entries">
            <result name="list" type="tiles">.Entries</result>
        </action>

        <action name="comments!*" method="{1}"
                class="org.apache.roller.weblogger.ui.struts2.editor.Comments">
            <result name="list" type="tiles">.Comments</result>
            <param name="actionName">comments</param>
            <param name="desiredMenu">editor</param>
            <result name="success" type="redirectAction">
                <param name="actionName">comments!updateMade</param>
                <param name="bean.entryId">${bean.entryId}</param>
                <param name="weblogId">${weblogId}</param>
            </result>
            <allowed-methods>query,update,updateMade</allowed-methods>
        </action>

        <action name="categories" class="org.apache.roller.weblogger.ui.struts2.util.UIAction">
            <param name="requiredGlobalRole">BLOGGER</param>
            <param name="requiredWeblogRole">POST</param>
            <param name="desiredMenu">editor</param>
            <param name="actionName">categories</param>
            <param name="pageTitleReal">categoriesForm.rootTitle</param>
            <result name="success" type="tiles">.Categories</result>
        </action>

        <action name="bookmarks"  class="org.apache.roller.weblogger.ui.struts2.util.UIAction">
            <param name="requiredGlobalRole">BLOGGER</param>
            <param name="requiredWeblogRole">OWNER</param>
            <param name="desiredMenu">editor</param>
            <param name="actionName">bookmarks</param>
            <param name="pageTitleReal">bookmarksForm.rootTitle</param>
            <result name="success" type="tiles">.Bookmarks</result>
        </action>

        <action name="weblogConfig" class="org.apache.roller.weblogger.ui.struts2.util.UIAction">
            <param name="requiredGlobalRole">BLOGGER</param>
            <param name="actionName">weblogConfig</param>
            <param name="desiredMenu">editor</param>
            <param name="pageTitleReal">websiteSettings.title</param>
            <result name="success" type="tiles">.WeblogConfig</result>
        </action>

        <action name="themeEdit" class="org.apache.roller.weblogger.ui.struts2.util.UIAction">
            <param name="requiredGlobalRole">BLOGGER</param>
            <param name="actionName">themeEdit</param>
            <param name="desiredMenu">editor</param>
            <param name="pageTitleReal">themeEditor.title</param>
            <result name="success" type="tiles">.ThemeEdit</result>
        </action>

        <action name="templates!*" method="{1}"
                class="org.apache.roller.weblogger.ui.struts2.editor.Templates">
            <result name="list" type="tiles">.Templates</result>
            <allowed-methods>add,newTheme,remove</allowed-methods>
        </action>

        <action name="templateEdit!*" method="{1}"
                class="org.apache.roller.weblogger.ui.struts2.editor.TemplateEdit">
            <result name="input" type="tiles">.TemplateEdit</result>
            <result name="list" type="chain">templates</result>
            <allowed-methods>delete,save</allowed-methods>
        </action>

        <action name="members!*" method="{1}"
                class="org.apache.roller.weblogger.ui.struts2.editor.Members">
            <result name="list" type="tiles">.Members</result>
            <result name="input" type="tiles">.Members</result>
            <result name="success" type="tiles">.Members</result>
            <allowed-methods>invite,save</allowed-methods>
        </action>

    </package>

</struts>
